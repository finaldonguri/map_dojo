// Cesium ionのアクセストークン
Cesium.Ion.defaultAccessToken =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIyOGRiZmY3Yy0wNzRjLTQ2MjktOGQ0Ni0xYmI5MzFmNDUxZDAiLCJpZCI6MzU0MDY0LCJpYXQiOjE3NjE0NTQ3MDh9.p9q4yTuNNbVz7U09nx04n-LQG0sxXh8TDw22H3FSIV0";

(async function () {
    const viewer = new Cesium.Viewer("cesiumContainer", {
        baseLayerPicker: true,
        timeline: false,
        animation: false,
        geocoder: false,
        homeButton: false
    });

    // 既定ベースレイヤーを完全に除去（誤動作防止）
    while (viewer.imageryLayers.length > 0) {
        viewer.imageryLayers.remove(viewer.imageryLayers.get(0), false);
    }

    viewer.scene.globe.enableLighting = true;
    viewer.clock.currentTime = Cesium.JulianDate.fromDate(new Date("2024-06-21T12:00:00Z"));
    viewer.clock.shouldAnimate = false;

    // ===== 地形（※ 二重定義しない）=====
    const terrainProvider = await Cesium.CesiumTerrainProvider.fromIonAssetId(2767062);
    viewer.terrainProvider = terrainProvider;

    // ===== 画像レイヤー定義 =====
    const layers = viewer.imageryLayers;

    // 衛星（Ion）
    const satelliteProvider = await Cesium.IonImageryProvider.fromAssetId(3830183);

    // 地理院 標準地図
    const gsiProvider = new Cesium.UrlTemplateImageryProvider({
        url: "https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",
        credit: new Cesium.Credit('<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>'),
        minimumLevel: 2,
        maximumLevel: 18,
    });

    // 古地図
    const providersOld = [
        new Cesium.UrlTemplateImageryProvider({
            url: "https://ktgis.net/kjmapw/kjtilemap/keihansin/2man/{z}/{x}/{y}.png", // 彦根東部
            credit: new Cesium.Credit("明治43年測図, 大正2年発行,『今昔マップ on the web, https://ktgis.net/kjmapw/tilemapservice.html "),
            minimumLevel: 2, maximumLevel: 16,
        }),
    ];

    // 追加して参照保持
    const layerSatellite = layers.addImageryProvider(satelliteProvider); // 衛星
    const layerGSI = layers.addImageryProvider(gsiProvider);       // 地理院
    const layerOlds = providersOld.map(p => layers.addImageryProvider(p)); // 古地図

    // 見た目調整
    [layerSatellite, layerGSI, ...layerOlds].forEach(l => {
        l.alpha = 1.0;
        l.brightness = 0.95;
    });

    // まず全OFF → 衛星のみON
    function allOff() {
        layerSatellite.show = false;
        layerGSI.show = false;
        layerOlds.forEach(l => l.show = false);
    }
    allOff();
    layerSatellite.show = true;

    // 排他的切替
    function showSatellite() { allOff(); layerSatellite.show = true; layers.lowerToBottom(layerSatellite); setActive("btn-satellite"); }
    function showGSI() { allOff(); layerGSI.show = true; layers.lowerToBottom(layerGSI); setActive("btn-gsi"); }
    function showOldMaps() { allOff(); layerOlds.forEach(l => l.show = true); layers.raiseToTop(layerOlds[layerOlds.length - 1]); setActive("btn-old"); }

    function setActive(id) {
        ["btn-gsi", "btn-satellite", "btn-old"].forEach(x => {
            const el = document.getElementById(x);
            if (el) el.classList.toggle("active", x === id);
        });
    }

    const btnSat = document.getElementById("btn-satellite");
    const btnGsi = document.getElementById("btn-gsi");
    const btnOld = document.getElementById("btn-old");
    if (btnSat) btnSat.onclick = showSatellite;
    if (btnGsi) btnGsi.onclick = showGSI;
    if (btnOld) btnOld.onclick = showOldMaps;
    setActive("btn-satellite");

    // ===== GeoJSON =====
    const routeGeojson = {
        type: "FeatureCollection",
        name: "route",
        crs: { type: "name", properties: { name: "urn:ogc:def:crs:OGC:1.3:CRS84" } },
        features: [
            { "type": "Feature", "properties": { "id": 1, "dojo_plots": "1" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.268102855045328, 34.86791223312818]] } },
            { "type": "Feature", "properties": { "id": 2, "dojo_plots": "2" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.272092579146005, 34.868188619584338]] } },
            { "type": "Feature", "properties": { "id": 3, "dojo_plots": "3" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.2755454274442, 34.869371888597385]] } },
            { "type": "Feature", "properties": { "id": 4, "dojo_plots": "4" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.277492918100194, 34.869881466357448]] } },
            { "type": "Feature", "properties": { "id": 5, "dojo_plots": "5" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.282935364960451, 34.871531094734046]] } },
            { "type": "Feature", "properties": { "id": 6, "dojo_plots": "6" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.283354250243519, 34.872714781788908]] } },
            { "type": "Feature", "properties": { "id": 7, "dojo_plots": "7" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.284022089840818, 34.873732325977016]] } },
            { "type": "Feature", "properties": { "id": 8, "dojo_plots": "8" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.287647504797604, 34.876993600682056]] } },
            { "type": "Feature", "properties": { "id": 9, "dojo_plots": "9" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.289364806619233, 34.877437124047518]] } },
            { "type": "Feature", "properties": { "id": 10, "dojo_plots": "10" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.287615702912007, 34.877384944952269]] } },
            { "type": "Feature", "properties": { "id": 11, "dojo_plots": "11" }, "geometry": { "type": "MultiPoint", "coordinates": [[135.290573278271467, 34.876393535849175]] } },
            {
                type: "Feature",
                properties: { name: "B", style: "arrow" },
                geometry: {
                    "type": "Feature", "properties": { "id": 1, "dojo_route": "1" }, "geometry": { "type": "MultiLineString", "coordinates": [[[135.268323242901516, 34.868944961185818, 600], [135.268323242901516, 34.868906243667624, 600], [135.268299647954166, 34.868867526131218, 600], [135.268299647954166, 34.868828808576538, 600], [135.268276053006815, 34.868790091003667, 600], [135.268276053006815, 34.868751373412543, 600], [135.268252458059408, 34.868712655803193, 600], [135.268228863112057, 34.868673938175611, 600], [135.268181673217299, 34.868654579354974, 600], [135.26815807826992, 34.868615861700057, 600], [135.26808729342784, 34.868577144026908, 600], [135.268063698480432, 34.868519067482985, 600], [135.268016508585703, 34.868519067482985, 600], [135.267992913638352, 34.868480349764255, 600], [135.267969318690973, 34.868441632027285, 600], [135.267969318690973, 34.868402914272096, 600], [135.267922128796215, 34.868383555387659, 600], [135.267898533848864, 34.868344837605122, 600], [135.267874938901485, 34.868306119804338, 600], [135.267874938901485, 34.868267401985349, 600], [135.267851343954135, 34.868228684148107, 600], [135.267851343954135, 34.868189966292654, 600], [135.267851343954135, 34.868151248418954, 600], [135.267851343954135, 34.868112530527029, 600], [135.267874938901485, 34.868073812616885, 600], [135.267898533848864, 34.868035094688494, 600], [135.267922128796215, 34.867996376741885, 600], [135.267945723743622, 34.867957658777044, 600], [135.267992913638352, 34.867938299787788, 600], [135.26804010353311, 34.86791894079397, 600], [135.26808729342784, 34.867899581795577, 600], [135.268134483322569, 34.867880222792657, 600], [135.268181673217299, 34.867880222792657, 600], [135.268252458059408, 34.867880222792657, 600], [135.268299647954166, 34.867880222792657, 600], [135.268346837848895, 34.867880222792657, 600], [135.268394027743625, 34.867880222792657, 600], [135.268441217638383, 34.867880222792657, 600], [135.268488407533113, 34.867880222792657, 600], [135.268535597427871, 34.867880222792657, 600], [135.2685827873226, 34.867880222792657, 600], [135.268629977217302, 34.867899581795577, 600], [135.268677167112088, 34.86791894079397, 600], [135.268724357006818, 34.867938299787788, 600], [135.268771546901576, 34.867938299787788, 600], [135.268818736796305, 34.867957658777044, 600], [135.268865926691035, 34.867977017761753, 600], [135.268913116585793, 34.867996376741885, 600], [135.268960306480523, 34.868015735717478, 600], [135.269007496375281, 34.868035094688494, 600], [135.269054686269982, 34.868035094688494, 600], [135.269149066059498, 34.868035094688494, 600], [135.269196255954228, 34.868035094688494, 600], [135.269243445848986, 34.868035094688494, 600], [135.269290635743687, 34.868035094688494, 600], [135.269337825638445, 34.868035094688494, 600], [135.269385015533175, 34.868015735717478, 600], [135.269432205427933, 34.868015735717478, 600], [135.269479395322662, 34.868015735717478, 600], [135.269526585217392, 34.867977017761753, 600], [135.26957377511215, 34.867957658777044, 600], [135.269620965006879, 34.867938299787788, 600], [135.26964455995423, 34.867899581795577, 600], [135.26969174984896, 34.867880222792657, 600], [135.269762534691097, 34.867841504773132, 600], [135.269809724585855, 34.867822145756506, 600], [135.269856914480584, 34.867802786735353, 600], [135.269904104375343, 34.867783427709639, 600], [135.269951294270072, 34.867764068679357, 600], [135.269998484164802, 34.867764068679357, 600], [135.27006926900691, 34.867725350605127, 600], [135.27011645890164, 34.867725350605127, 600], [135.270163648796398, 34.867725350605127, 600], [135.270210838691128, 34.867725350605127, 600], [135.270258028585886, 34.867705991561181, 600], [135.270305218480615, 34.867705991561181, 600], [135.270352408375345, 34.86766727345961, 600], [135.270399598270103, 34.86766727345961, 600], [135.270470383112155, 34.86766727345961, 600], [135.270517573006941, 34.86766727345961, 600], [135.270564762901671, 34.86766727345961, 600], [135.270611952796429, 34.86766727345961, 600], [135.270659142691159, 34.86766727345961, 600], [135.270706332585917, 34.86766727345961, 600], [135.270800712375348, 34.86766727345961, 600], [135.270847902270134, 34.86766727345961, 600], [135.270895092164807, 34.86766727345961, 600], [135.270942282059622, 34.86766727345961, 600], [135.270989471954351, 34.86766727345961, 600], [135.271036661849053, 34.867686632512672, 600], [135.271083851743839, 34.867705991561181, 600], [135.27113104163854, 34.867725350605127, 600], [135.271178231533327, 34.867725350605127, 600], [135.271225421428028, 34.867744709644519, 600], [135.271272611322757, 34.867764068679357, 600], [135.271319801217487, 34.867802786735353, 600], [135.271366991112245, 34.867841504773132, 600], [135.271414181007032, 34.867860863785175, 600], [135.271437775954382, 34.867899581795577, 600], [135.271484965849112, 34.867899581795577, 600], [135.271555750691221, 34.867938299787788, 600], [135.27160294058595, 34.867957658777044, 600], [135.271650130480708, 34.867996376741885, 600], [135.271697320375438, 34.868035094688494, 600], [135.271744510270167, 34.868073812616885, 600], [135.271791700164925, 34.868093171574245, 600], [135.271815295112305, 34.868131889475272, 600], [135.271862485007034, 34.868131889475272, 600], [135.271909674901792, 34.868151248418954, 600], [135.271956864796522, 34.868189966292654, 600], [135.272004054691251, 34.868209325222665, 600], [135.272051244586009, 34.868228684148107, 600], [135.272169219322848, 34.868325478707014, 600], [135.272216409217549, 34.868344837605122, 600], [135.272240004164956, 34.868383555387659, 600], [135.272287194059686, 34.868422273151978, 600], [135.272334383954444, 34.868422273151978, 600], [135.272381573849174, 34.868460990898051, 600], [135.272405168796553, 34.86849970862589, 600], [135.272452358691254, 34.868519067482985, 600], [135.27249954858604, 34.868557785183484, 600], [135.272546738480742, 34.868577144026908, 600], [135.272593928375528, 34.868615861700057, 600], [135.272688308164987, 34.868673938175611, 600], [135.272829877849233, 34.868673938175611, 600], [135.272877067743934, 34.868673938175611, 600], [135.272924257638692, 34.868673938175611, 600], [135.272971447533422, 34.868673938175611, 600], [135.27301863742818, 34.868673938175611, 600], [135.27308942227026, 34.868673938175611, 600], [135.27313661216499, 34.868673938175611, 600], [135.273183802059748, 34.868673938175611, 600], [135.273230991954478, 34.868673938175611, 600], [135.273301776796615, 34.868673938175611, 600], [135.273348966691344, 34.86869329699168, 600], [135.273396156586074, 34.868712655803193, 600], [135.273443346480832, 34.868712655803193, 600], [135.273490536375562, 34.868732014610146, 600], [135.27356132121767, 34.868751373412543, 600], [135.2736085111124, 34.868770732210379, 600], [135.273655701007158, 34.868770732210379, 600], [135.273702890901916, 34.868790091003667, 600], [135.273750080796646, 34.86880944979238, 600], [135.273820865638726, 34.868828808576538, 600], [135.273868055533512, 34.868848167356155, 600], [135.273938840375564, 34.868848167356155, 600], [135.273986030270351, 34.868867526131218, 600], [135.27403322016508, 34.868867526131218, 600], [135.274104005007189, 34.868886884901698, 600], [135.274151194901918, 34.868886884901698, 600], [135.274198384796676, 34.868886884901698, 600], [135.274245574691406, 34.868886884901698, 600], [135.274292764586107, 34.868906243667624, 600], [135.274339954480894, 34.868906243667624, 600], [135.274410739322974, 34.868925602429009, 600], [135.27445792921776, 34.868944961185818, 600], [135.274505119112462, 34.86896431993808, 600], [135.274575903954599, 34.869003037428932, 600], [135.2746230938493, 34.869003037428932, 600], [135.274670283744086, 34.869003037428932, 600], [135.274717473638788, 34.869003037428932, 600], [135.274764663533574, 34.86902239616753, 600], [135.274811853428275, 34.869041754901566, 600], [135.274859043323005, 34.869061113631034, 600], [135.274906233217763, 34.869061113631034, 600], [135.274953423112493, 34.869061113631034, 600], [135.275000613007279, 34.869061113631034, 600], [135.27504780290198, 34.869080472355954, 600], [135.27509499279671, 34.869099831076305, 600], [135.275142182691468, 34.869099831076305, 600], [135.275189372586198, 34.869119189792109, 600], [135.275236562480956, 34.869138548503344, 600], [135.275307347323064, 34.869157907210038, 600], [135.275378132165173, 34.869196624609742, 600], [135.275448917007282, 34.8692353419912, 600], [135.27549610690204, 34.869254700675093, 600], [135.27551970184939, 34.869293418029208, 600], [135.275566891744091, 34.869312776699438, 600], [135.275614081638878, 34.869351494026191, 600], [135.275661271533608, 34.869390211334753, 600], [135.275708461428366, 34.869428928625069, 600], [135.275732056375745, 34.869467645897146, 600], [135.275732056375745, 34.869506363150997, 600], [135.275732056375745, 34.869545080386622, 600], [135.275732056375745, 34.869583797604008, 600], [135.275732056375745, 34.869622514803154, 600], [135.275732056375745, 34.86966123198409, 600], [135.275732056375745, 34.86971930772129, 600], [135.275732056375745, 34.869777383417485, 600], [135.275732056375745, 34.869835459072654, 600], [135.275732056375745, 34.86987417615331, 600], [135.275732056375745, 34.869912893215741, 600], [135.275779246270446, 34.869912893215741, 600], [135.275850031112583, 34.869912893215741, 600], [135.275897221007284, 34.869893534686803, 600], [135.276038790691501, 34.869893534686803, 600], [135.276085980586288, 34.869893534686803, 600], [135.276180360375776, 34.869893534686803, 600], [135.276227550270477, 34.869893534686803, 600], [135.276274740165206, 34.869893534686803, 600], [135.276321930059964, 34.869893534686803, 600], [135.276392714902101, 34.869893534686803, 600], [135.276463499744182, 34.869893534686803, 600], [135.27653428458629, 34.869893534686803, 600], [135.27658147448102, 34.869893534686803, 600], [135.276628664375806, 34.869893534686803, 600], [135.276675854270508, 34.869893534686803, 600], [135.276723044165237, 34.869893534686803, 600], [135.276793829007374, 34.869893534686803, 600], [135.276841018902132, 34.869893534686803, 600], [135.276888208796862, 34.869912893215741, 600], [135.276911803744213, 34.869951610259939, 600], [135.276958993638971, 34.869951610259939, 600], [135.2770061835337, 34.869970968775192, 600], [135.277029778481079, 34.870009685792041, 600], [135.277076968375809, 34.870009685792041, 600], [135.277171348165297, 34.870009685792041, 600], [135.277242133007405, 34.870009685792041, 600], [135.277312917849514, 34.870009685792041, 600], [135.277360107744272, 34.870009685792041, 600], [135.277430892586324, 34.870009685792041, 600], [135.27747808248111, 34.869970968775192, 600], [135.277548867323219, 34.869951610259939, 600], [135.277572462270598, 34.869912893215741, 600], [135.277619652165271, 34.869893534686803, 600], [135.277643247112678, 34.869854817615263, 600], [135.277690437007465, 34.869835459072654, 600], [135.277714031954815, 34.869796741973765, 600], [135.277737626902166, 34.869758024856644, 600], [135.277761221849516, 34.86971930772129, 600], [135.277784816796924, 34.86966123198409, 600], [135.277855601639004, 34.869641873395899, 600], [135.277855601639004, 34.869603156205855, 600], [135.277902791533791, 34.869583797604008, 600], [135.277973576375871, 34.869506363150997, 600], [135.278020766270629, 34.869487004526349, 600], [135.278091551112709, 34.869448287263381, 600], [135.278138741007496, 34.869428928625069, 600], [135.278233120796926, 34.869390211334753, 600], [135.278280310691684, 34.869390211334753, 600], [135.278327500586414, 34.869370852682742, 600], [135.278374690481172, 34.869332135365092, 600], [135.278421880375902, 34.869332135365092, 600], [135.27846907027066, 34.869312776699438, 600], [135.27853985511274, 34.869293418029208, 600], [135.278610639954877, 34.869293418029208, 600], [135.278657829849607, 34.869254700675093, 600], [135.278728614691715, 34.8692353419912, 600], [135.278775804586445, 34.8692353419912, 600], [135.278822994481203, 34.869215983302745, 600], [135.278870184375933, 34.869196624609742, 600], [135.27896456416542, 34.869196624609742, 600], [135.279035349007529, 34.869177265912164, 600], [135.279106133849638, 34.869177265912164, 600], [135.279176918691746, 34.869157907210038, 600], [135.279247703533827, 34.869138548503344, 600], [135.279412868165451, 34.869119189792109, 600], [135.279460058060181, 34.869119189792109, 600], [135.279578032797019, 34.869099831076305, 600], [135.279648817639156, 34.869061113631034, 600], [135.279696007533886, 34.869041754901566, 600], [135.279743197428644, 34.869003037428932, 600], [135.279790387323374, 34.869003037428932, 600], [135.279884767112861, 34.868944961185818, 600], [135.279931957007562, 34.868944961185818, 600], [135.280049931744429, 34.868906243667624, 600], [135.280097121639159, 34.868906243667624, 600], [135.280144311533917, 34.868886884901698, 600], [135.280215096375997, 34.868886884901698, 600], [135.280262286270755, 34.868867526131218, 600], [135.280309476165485, 34.868848167356155, 600], [135.280285881218134, 34.868886884901698, 600], [135.280285881218134, 34.868944961185818, 600], [135.280285881218134, 34.868983678685787, 600], [135.280309476165485, 34.86902239616753, 600], [135.280356666060243, 34.869041754901566, 600], [135.280403855954972, 34.869061113631034, 600], [135.28045104584973, 34.869099831076305, 600], [135.28049823574446, 34.869138548503344, 600], [135.280521830691839, 34.869177265912164, 600], [135.280569020586569, 34.869177265912164, 600], [135.280616210481327, 34.869215983302745, 600], [135.280663400376056, 34.869274059354417, 600], [135.280686995323435, 34.869312776699438, 600], [135.280710590270814, 34.869351494026191, 600], [135.280734185218165, 34.869390211334753, 600], [135.280757780165544, 34.869428928625055, 600], [135.280757780165544, 34.869467645897146, 600], [135.280804970060274, 34.869487004526349, 600], [135.280804970060274, 34.869525721771076, 600], [135.280828565007653, 34.869564438997585, 600], [135.280852159955032, 34.869603156205855, 600], [135.280875754902354, 34.869641873395899, 600], [135.280875754902354, 34.869680590567711, 600], [135.280899349849761, 34.86971930772129, 600], [135.28092294479714, 34.869758024856644, 600], [135.280946539744519, 34.869796741973765, 600], [135.280946539744519, 34.869835459072654, 600], [135.280993729639221, 34.86987417615331, 600], [135.281017324586571, 34.869912893215741, 600], [135.281040919534007, 34.869951610259939, 600], [135.281088109428708, 34.869970968775192, 600], [135.281111704376059, 34.870009685792041, 600], [135.281158894270845, 34.870029044293631, 600], [135.281229679112926, 34.870067761283124, 600], [135.281276869007712, 34.870106478254399, 600], [135.281324058902413, 34.870125836733195, 600], [135.281347653849764, 34.870164553677121, 600], [135.28139484374455, 34.870164553677121, 600], [135.281442033639252, 34.870203270602808, 600], [135.281465628586631, 34.87024198751029, 600], [135.281512818481389, 34.870261345957175, 600], [135.281560008376118, 34.870280704399526, 600], [135.281607198270876, 34.870300062837288, 600], [135.281654388165606, 34.870319421270509, 600], [135.281701578060336, 34.870358138123294, 600], [135.281748767955094, 34.870377496542837, 600], [135.281795957849823, 34.870396854957832, 600], [135.281843147744553, 34.870396854957832, 600], [135.281890337639283, 34.870435571774145, 600], [135.281937527534069, 34.870454930175462, 600], [135.28198471742877, 34.870474288572218, 600], [135.2820319073235, 34.870493646964427, 600], [135.282079097218258, 34.870513005352059, 600], [135.282126287112987, 34.870532363735151, 600], [135.282197071955125, 34.87057108048765, 600], [135.282244261849854, 34.870590438857064, 600], [135.282291451744555, 34.870609797221917, 600], [135.282362236586692, 34.870648513937951, 600], [135.28243302142883, 34.870667872289125, 600], [135.282480211323559, 34.870725947315329, 600], [135.282527401218289, 34.870745305648292, 600], [135.282574591113047, 34.870784022300519, 600], [135.282621781007776, 34.870822738934514, 600], [135.282668970902535, 34.870861455550283, 600], [135.282716160797236, 34.870880813851329, 600], [135.282763350691994, 34.870900172147806, 600], [135.282810540586752, 34.870938888727117, 600], [135.282834135534074, 34.870977605288196, 600], [135.28288132542886, 34.870977605288196, 600], [135.282904920376239, 34.871016321831021, 600], [135.282952110270941, 34.871074396611114, 600], [135.282975705218291, 34.871113113108372, 600], [135.282975705218291, 34.871151829587411, 600], [135.283022895113078, 34.871171187820082, 600], [135.283022895113078, 34.871209904271772, 600], [135.283046490060428, 34.871248620705231, 600], [135.283046490060428, 34.871287337120457, 600], [135.283046490060428, 34.871326053517436, 600], [135.283046490060428, 34.871364769896211, 600], [135.283046490060428, 34.871403486256732, 600], [135.283046490060428, 34.871442202599042, 600], [135.283046490060428, 34.871480918923105, 600], [135.283046490060428, 34.871519635228935, 600], [135.283046490060428, 34.871558351516541, 600], [135.283022895113078, 34.871597067785913, 600], [135.282999300165699, 34.871635784037053, 600], [135.282999300165699, 34.871674500269968, 600], [135.282999300165699, 34.871732574585145, 600], [135.282975705218291, 34.871771290772472, 600], [135.282975705218291, 34.871810006941587, 600], [135.28292851532359, 34.871848723092448, 600], [135.28292851532359, 34.871887439225098, 600], [135.28292851532359, 34.871926155339494, 600], [135.282904920376239, 34.871984229476929, 600], [135.282857730481481, 34.872042303573338, 600], [135.282857730481481, 34.872100377628719, 600], [135.282810540586752, 34.872139093642858, 600], [135.282786945639373, 34.872177809638757, 600], [135.282810540586752, 34.87221652561643, 600], [135.282810540586752, 34.872255241575857, 600], [135.282857730481481, 34.87229395751708, 600], [135.28288132542886, 34.872332673440056, 600], [135.28288132542886, 34.872371389344792, 600], [135.28292851532359, 34.872390747290332, 600], [135.282952110270941, 34.872429463167734, 600], [135.282975705218291, 34.872468179026889, 600], [135.283022895113078, 34.872506894867826, 600], [135.283046490060428, 34.872545610690537, 600], [135.283093679955186, 34.872564968595057, 600], [135.283117274902565, 34.872603684390405, 600], [135.283164464797267, 34.872623042281248, 600], [135.283211654691996, 34.872642400167535, 600], [135.283258844586754, 34.872661758049261, 600], [135.283282439534133, 34.872700473799036, 600], [135.283329629428891, 34.872719831667084, 600], [135.283376819323621, 34.87273918953057, 600], [135.283424009218351, 34.872797263093709, 600], [135.28347119911308, 34.872797263093709, 600], [135.283518389007838, 34.872797263093709, 600], [135.283565578902596, 34.872816620938977, 600], [135.283612768797326, 34.872835978779676, 600], [135.283659958692056, 34.872855336615835, 600], [135.283707148586785, 34.872874694447411, 600], [135.283777933428894, 34.872874694447411, 600], [135.283848718271003, 34.872894052274454, 600], [135.283895908165732, 34.872913410096913, 600], [135.28394309806049, 34.872913410096913, 600], [135.28399028795522, 34.872932767914833, 600], [135.284013882902599, 34.872971483536993, 600], [135.284084667744708, 34.872971483536993, 600], [135.284131857639437, 34.872971483536993, 600], [135.284155452586788, 34.873010199140907, 600], [135.284202642481574, 34.873029556936054, 600], [135.284249832376304, 34.873029556936054, 600], [135.284297022271062, 34.873048914726617, 600], [135.284344212165735, 34.873087630294066, 600], [135.284344212165735, 34.873126345843303, 600], [135.284344212165735, 34.873165061374308, 600], [135.284344212165735, 34.873203776887067, 600], [135.284344212165735, 34.8732424923816, 600], [135.284344212165735, 34.873300565589211, 600], [135.284297022271062, 34.873339281038163, 600], [135.284273427323683, 34.873377996468903, 600], [135.284273427323683, 34.873416711881397, 600], [135.284226237428925, 34.873455427275658, 600], [135.284226237428925, 34.873494142651687, 600], [135.284202642481574, 34.873532858009476, 600], [135.284202642481574, 34.873571573349032, 600], [135.284202642481574, 34.87361028867037, 600], [135.284179047534195, 34.873649003973483, 600], [135.284155452586788, 34.873687719258349, 600], [135.284131857639437, 34.873726434524983, 600], [135.284131857639437, 34.873765149773398, 600], [135.284131857639437, 34.873803865003566, 600], [135.284108262692087, 34.873842580215502, 600], [135.284108262692087, 34.87388129540922, 600], [135.284084667744708, 34.873920010584705, 600], [135.284084667744708, 34.87395872574195, 600], [135.284084667744708, 34.873997440880956, 600], [135.284084667744708, 34.874036156001736, 600], [135.284084667744708, 34.874074871104291, 600], [135.284084667744708, 34.874113586188614, 600], [135.284084667744708, 34.874152301254703, 600], [135.284108262692087, 34.874191016302547, 600], [135.284131857639437, 34.874229731332186, 600], [135.284155452586788, 34.874268446343571, 600], [135.284179047534195, 34.874307161336731, 600], [135.284226237428925, 34.874326518826479, 600], [135.284249832376304, 34.874365233792297, 600], [135.284297022271062, 34.874384591268345, 600], [135.284344212165735, 34.874403948739875, 600], [135.284367807113114, 34.874442663669214, 600], [135.2844149970079, 34.874462021127052, 600], [135.284438591955279, 34.874500736029049, 600], [135.284485781850009, 34.874520093473222, 600], [135.284509376797388, 34.874558808347871, 600], [135.284556566692117, 34.87459752320428, 600], [135.284580161639468, 34.874636238042484, 600], [135.284603756586819, 34.874674952862449, 600], [135.284603756586819, 34.874713667664153, 600], [135.284603756586819, 34.87475238244766, 600], [135.284627351534226, 34.87479109721292, 600], [135.284698136376306, 34.874849169326616, 600], [135.284768921218443, 34.874926598747734, 600], [135.284792516165794, 34.87496531343097, 600], [135.284839706060524, 34.874984670765741, 600], [135.284886895955282, 34.875004028095937, 600], [135.284910490902661, 34.875042742742693, 600], [135.28495768079739, 34.875062100059239, 600], [135.285004870692148, 34.875100814678639, 600], [135.285052060586878, 34.875139529279807, 600], [135.285099250481608, 34.875139529279807, 600], [135.285099250481608, 34.875178243862756, 600], [135.285170035323716, 34.87519760114737, 600], [135.285217225218446, 34.875236315702978, 600], [135.285264415113204, 34.87529438750218, 600], [135.285335199955313, 34.875333102012185, 600], [135.285358794902692, 34.875391173743019, 600], [135.285382389850071, 34.875429888207442, 600], [135.285405984797421, 34.875468602653655, 600], [135.285453174692179, 34.87552667428875, 600], [135.285476769639558, 34.875565388689381, 600], [135.285523959534288, 34.875604103071758, 600], [135.285571149429018, 34.875623460256129, 600], [135.285594744376397, 34.875662174611136, 600], [135.285641934271126, 34.875700888947954, 600], [135.285641934271126, 34.875739603266524, 600], [135.285689124165884, 34.87575896041897, 600], [135.285689124165884, 34.875797674710199, 600], [135.285712719113235, 34.875836388983181, 600], [135.285736314060614, 34.875875103237945, 600], [135.285759909007965, 34.875913817474483, 600], [135.285783503955315, 34.875952531692775, 600], [135.285807098902723, 34.876010602986028, 600], [135.285830693850102, 34.876049317158746, 600], [135.285854288797452, 34.876088031313223, 600], [135.285877883744803, 34.876126745449476, 600], [135.28594866858694, 34.876165459567488, 600], [135.28594866858694, 34.876204173667276, 600], [135.28594866858694, 34.876242887748823, 600], [135.285972263534262, 34.876281601812146, 600], [135.28601945342902, 34.876320315857228, 600], [135.286043048376428, 34.876359029884085, 600], [135.286113833218508, 34.87641710089018, 600], [135.286113833218508, 34.876455814871456, 600], [135.286161023113294, 34.876475171855247, 600], [135.286161023113294, 34.876513885809182, 600], [135.286208213007995, 34.876571956705881, 600], [135.286231807955346, 34.87661067061422, 600], [135.286255402902754, 34.876668741442543, 600], [135.286255402902754, 34.876707455305315, 600], [135.286278997850133, 34.876746169149854, 600], [135.286326187744834, 34.876784882976139, 600], [135.286326187744834, 34.876842953681404, 600], [135.286349782692241, 34.876881667462108, 600], [135.286396972586971, 34.876920381224593, 600], [135.286396972586971, 34.876959094968861, 600], [135.286396972586971, 34.876997808694867, 600], [135.2864441624817, 34.877017165551045, 600], [135.286491352376459, 34.877017165551045, 600], [135.286538542271188, 34.877017165551045, 600], [135.286585732165946, 34.877017165551045, 600], [135.286632922060676, 34.877017165551045, 600], [135.286680111955405, 34.877017165551045, 600], [135.286750896797514, 34.877036522402669, 600], [135.286798086692244, 34.877036522402669, 600], [135.286845276587002, 34.877055879249717, 600], [135.286845276587002, 34.877094592930149, 600], [135.286892466481731, 34.87711394976354, 600], [135.28696325132384, 34.877152663416624, 600], [135.286986846271219, 34.877191377051481, 600], [135.287034036165949, 34.8772300906681, 600], [135.287034036165949, 34.877268804266485, 600], [135.287057631113328, 34.877307517846646, 600], [135.287104821008086, 34.877326874629887, 600], [135.287104821008086, 34.877365588182684, 600], [135.287104821008086, 34.877404301717263, 600], [135.287128415955436, 34.877443015233602, 600], [135.287128415955436, 34.87748172873173, 600], [135.287152010902815, 34.877520442211605, 600], [135.287175605850138, 34.877559155673254, 600], [135.287199200797545, 34.877597869116663, 600], [135.287199200797545, 34.87763658254184, 600], [135.287199200797545, 34.877675295948791, 600], [135.287246390692303, 34.877694652645431, 600], [135.287269985639654, 34.877733366025005, 600], [135.287317175534412, 34.877772079386396, 600], [135.287340770481791, 34.87781079272952, 600], [135.287387960376492, 34.877868862710038, 600], [135.287411555323843, 34.877907576007587, 600], [135.287411555323843, 34.877946289286903, 600], [135.28743515027125, 34.877985002547973, 600], [135.287458745218629, 34.877946289286903, 600], [135.287482340166008, 34.877907576007587, 600], [135.287482340166008, 34.877868862710038, 600], [135.287482340166008, 34.877830149394249, 600], [135.287482340166008, 34.877791436060235, 600], [135.287482340166008, 34.877752722707982, 600], [135.287482340166008, 34.877714009337495, 600], [135.287482340166008, 34.877655939247596, 600], [135.287482340166008, 34.877617225831521, 600], [135.287482340166008, 34.877578512397243, 600], [135.287482340166008, 34.877539798944703, 600], [135.287482340166008, 34.877501085473945, 600], [135.287482340166008, 34.877462371984933, 600], [135.287482340166008, 34.877384944952269, 600], [135.287482340166008, 34.877326874629887, 600], [135.28750593511333, 34.877249447469573, 600], [135.287529530060738, 34.877210733862057, 600], [135.287553125008117, 34.877172020236323, 600], [135.287553125008117, 34.877133306592349, 600], [135.287553125008117, 34.877094592930149, 600], [135.287576719955496, 34.877036522402669, 600], [135.287600314902789, 34.876997808694867, 600], [135.287623909850197, 34.876959094968861, 600], [135.287647504797548, 34.876920381224593, 600], [135.287647504797548, 34.876881667462108, 600], [135.287671099744955, 34.876842953681404, 600], [135.287718289639685, 34.876746169149854, 600], [135.287789074481822, 34.876707455305315, 600], [135.287812669429172, 34.876668741442543, 600], [135.287859859323873, 34.876630027561561, 600], [135.287883454271253, 34.876591313662324, 600], [135.28790704921866, 34.87653324277931, 600], [135.287954239113361, 34.876475171855247, 600], [135.28797783406074, 34.876436457883102, 600], [135.28797783406074, 34.876397743892703, 600], [135.28797783406074, 34.876339672872938, 600], [135.28802502395547, 34.876339672872938, 600], [135.288095808797578, 34.876320315857228, 600], [135.288142998692308, 34.876300958836964, 600], [135.288213783534474, 34.876300958836964, 600], [135.288308163323933, 34.876300958836964, 600], [135.288426138060771, 34.876281601812146, 600], [135.288473327955529, 34.876262244782758, 600], [135.288544112797638, 34.876262244782758, 600], [135.288591302692396, 34.876262244782758, 600], [135.288638492587125, 34.876262244782758, 600], [135.288685682481855, 34.876262244782758, 600], [135.288732872376613, 34.876262244782758, 600], [135.288780062271343, 34.876262244782758, 600], [135.288827252166101, 34.876262244782758, 600], [135.28887444206083, 34.876262244782758, 600], [135.288945226902939, 34.876262244782758, 600], [135.289016011745019, 34.876262244782758, 600], [135.289063201639806, 34.876262244782758, 600], [135.289110391534535, 34.876262244782758, 600], [135.289157581429265, 34.876262244782758, 600], [135.289228366271317, 34.876262244782758, 600], [135.289275556166132, 34.876262244782758, 600], [135.289322746060861, 34.876262244782758, 600], [135.28939353090297, 34.876262244782758, 600], [135.2894407207977, 34.876281601812146, 600], [135.289487910692458, 34.876281601812146, 600], [135.289535100587216, 34.876300958836964, 600], [135.289582290481917, 34.876339672872938, 600], [135.289629480376675, 34.876339672872938, 600], [135.289653075323997, 34.876378386890678, 600], [135.289676670271376, 34.87641710089018, 600], [135.289723860166163, 34.876436457883102, 600], [135.289747455113542, 34.876475171855247, 600], [135.289723860166163, 34.87653324277931, 600], [135.289723860166163, 34.876571956705881, 600], [135.289700265218755, 34.87661067061422, 600], [135.289700265218755, 34.876649384504326, 600], [135.289653075323997, 34.876688098376221, 600], [135.289629480376675, 34.876746169149854, 600], [135.289629480376675, 34.876784882976139, 600], [135.289629480376675, 34.876823596784206, 600], [135.289629480376675, 34.876862310574026, 600], [135.289629480376675, 34.876920381224593, 600], [135.289629480376675, 34.876959094968861, 600], [135.289605885429268, 34.876997808694867, 600], [135.289582290481917, 34.877036522402669, 600], [135.289582290481917, 34.87707523609221, 600], [135.289558695534538, 34.87711394976354, 600], [135.289535100587216, 34.877152663416624, 600], [135.289535100587216, 34.877191377051481, 600], [135.289487910692458, 34.877249447469573, 600], [135.28946431574505, 34.877307517846646, 600], [135.2894407207977, 34.877365588182684, 600], [135.289417125850349, 34.877404301717263, 600], [135.28939353090297, 34.877443015233602, 600], [135.28939353090297, 34.87748172873173, 600], [135.28939353090297, 34.877520442211605, 600], [135.289369935955563, 34.877559155673254, 600], [135.289346341008212, 34.877597869116663, 600], [135.289322746060861, 34.87763658254184, 600], [135.289322746060861, 34.877694652645431, 600], [135.289322746060861, 34.877733366025005, 600], [135.289322746060861, 34.877772079386396, 600], [135.289322746060861, 34.87781079272952, 600], [135.289322746060861, 34.877849506054417, 600], [135.289322746060861, 34.877888219361083, 600], [135.289322746060861, 34.877926932649522, 600], [135.289322746060861, 34.877965645919723, 600], [135.289322746060861, 34.878004359171683, 600], [135.289322746060861, 34.878043072405418, 600], [135.289322746060861, 34.878081785620921, 600], [135.289322746060861, 34.878120498818191, 600], [135.289322746060861, 34.878159211997243, 600], [135.289322746060861, 34.878197925158027, 600], [135.289322746060861, 34.878236638300606, 600], [135.289299151113511, 34.878275351424946, 600], [135.289275556166132, 34.87831406453104, 600], [135.289228366271317, 34.878372134156024, 600], [135.289228366271317, 34.878410847216557, 600], [135.289228366271317, 34.878449560258844, 600], [135.289228366271317, 34.878488273282905, 600], [135.289228366271317, 34.878526986288726, 600], [135.289228366271317, 34.878585055763274, 600], [135.289204771324023, 34.878643125196795, 600], [135.289157581429265, 34.878701194589311, 600], [135.289110391534535, 34.878739907494847, 600], [135.289063201639806, 34.878778620382157, 600], [135.289016011745019, 34.878797976818973, 600], [135.288968821850318, 34.878836689678941, 600], [135.288945226902939, 34.87887540252067, 600], [135.288898037008181, 34.878894758934692, 600], [135.28887444206083, 34.878933471749072, 600], [135.288850847113451, 34.878972184545212, 600], [135.288803657218665, 34.879010897323113, 600], [135.288780062271343, 34.879049610082816, 600], [135.288732872376613, 34.879088322824252, 600], [135.288685682481855, 34.879107679188138, 600], [135.288638492587125, 34.879146391902232, 600], [135.288591302692396, 34.879146391902232, 600], [135.288544112797638, 34.879146391902232, 600], [135.288496922902908, 34.879146391902232, 600], [135.288449733008179, 34.879146391902232, 600], [135.288402543113421, 34.879107679188138, 600], [135.288378948166041, 34.879068966455804, 600], [135.288355353218691, 34.879030253705238, 600], [135.288355353218691, 34.878991540936461, 600], [135.288308163323933, 34.878991540936461, 600], [135.288284568376554, 34.878933471749072, 600], [135.288260973429203, 34.87887540252067, 600], [135.288237378481853, 34.878836689678941, 600], [135.288237378481853, 34.878797976818973, 600], [135.288237378481853, 34.878739907494847, 600], [135.288213783534474, 34.878701194589311, 600], [135.288190188587066, 34.878662481665529, 600], [135.288166593639716, 34.878623768723521, 600], [135.288166593639716, 34.878565699276322, 600], [135.288142998692308, 34.878526986288726, 600], [135.288119403744957, 34.878488273282905, 600], [135.288072213850228, 34.878468916773151, 600], [135.28802502395547, 34.878468916773151, 600], [135.28797783406074, 34.878449560258844, 600], [135.287883454271253, 34.878430203739981, 600], [135.287789074481822, 34.878410847216557, 600], [135.287741884587035, 34.878391490688571, 600], [135.287694694692334, 34.878391490688571, 600], [135.287647504797548, 34.878372134156024, 600], [135.287623909850197, 34.878333421077279, 600], [135.287576719955496, 34.878333421077279, 600], [135.287576719955496, 34.878294707980274, 600], [135.287529530060738, 34.878275351424946, 600], [135.287529530060738, 34.878236638300606, 600], [135.28750593511333, 34.878197925158027, 600], [135.287482340166008, 34.878159211997243, 600], [135.287482340166008, 34.878120498818191, 600], [135.287482340166008, 34.878081785620921, 600], [135.287482340166008, 34.878043072405418, 600], [135.287482340166008, 34.878004359171683, 600], [135.287482340166008, 34.877965645919723, 600], [135.287482340166008, 34.877907576007587, 600], [135.287482340166008, 34.877868862710038, 600], [135.287482340166008, 34.87781079272952, 600], [135.287482340166008, 34.877733366025005, 600], [135.28750593511333, 34.877694652645431, 600], [135.287529530060738, 34.877617225831521, 600], [135.287529530060738, 34.877578512397243, 600], [135.287529530060738, 34.877520442211605, 600], [135.287553125008117, 34.87748172873173, 600], [135.287576719955496, 34.877443015233602, 600], [135.287576719955496, 34.877384944952269, 600], [135.287576719955496, 34.877346231408559, 600], [135.287576719955496, 34.877307517846646, 600], [135.287576719955496, 34.877268804266485, 600], [135.287576719955496, 34.877210733862057, 600], [135.287576719955496, 34.877152663416624, 600], [135.287576719955496, 34.87711394976354, 600], [135.287576719955496, 34.87707523609221, 600], [135.287576719955496, 34.877036522402669, 600], [135.287576719955496, 34.876997808694867, 600], [135.287623909850197, 34.876939738099011, 600], [135.287671099744955, 34.876901024345621, 600], [135.287694694692334, 34.876862310574026, 600], [135.287741884587035, 34.876842953681404, 600], [135.287789074481822, 34.876823596784206, 600], [135.287859859323873, 34.87676552606527, 600], [135.28790704921866, 34.876707455305315, 600], [135.287954239113361, 34.876688098376221, 600], [135.288001429008148, 34.876649384504326, 600], [135.288048618902849, 34.876630027561561, 600], [135.288142998692308, 34.876571956705881, 600], [135.288213783534474, 34.876513885809182, 600], [135.288260973429203, 34.876475171855247, 600], [135.288308163323933, 34.876475171855247, 600], [135.288355353218691, 34.87641710089018, 600], [135.288426138060771, 34.876378386890678, 600], [135.288473327955529, 34.876359029884085, 600], [135.288520517850259, 34.876339672872938, 600], [135.288567707744988, 34.876339672872938, 600], [135.288638492587125, 34.876320315857228, 600], [135.288685682481855, 34.876320315857228, 600], [135.288732872376613, 34.876320315857228, 600], [135.288780062271343, 34.876320315857228, 600], [135.288827252166101, 34.876320315857228, 600], [135.288898037008181, 34.876320315857228, 600], [135.288968821850318, 34.876320315857228, 600], [135.289016011745019, 34.876339672872938, 600], [135.289063201639806, 34.876359029884085, 600], [135.289110391534535, 34.876378386890678, 600], [135.289157581429265, 34.876397743892703, 600], [135.289251961218724, 34.87641710089018, 600], [135.289322746060861, 34.876436457883102, 600], [135.289417125850349, 34.876455814871456, 600], [135.289511505639837, 34.876475171855247, 600], [135.289558695534538, 34.876475171855247, 600], [135.289629480376675, 34.876475171855247, 600], [135.289700265218755, 34.876475171855247, 600], [135.289747455113542, 34.876475171855247, 600], [135.289818239955594, 34.876475171855247, 600], [135.289912619745081, 34.876475171855247, 600], [135.289983404587218, 34.876475171855247, 600], [135.290030594481948, 34.876475171855247, 600], [135.290077784376678, 34.876494528834485, 600], [135.290148569218786, 34.876494528834485, 600], [135.290219354060923, 34.876494528834485, 600], [135.290266543955653, 34.876494528834485, 600], [135.290384518692491, 34.876494528834485, 600], [135.290431708587249, 34.876494528834485, 600]]] }
                }
            }
        ]
    };

    const guideBEntities = []; // B（概要ガイド）参照用

    try {
        const ds = await Cesium.GeoJsonDataSource.load(routeGeojson);
        viewer.dataSources.add(ds);

        for (const entity of ds.entities.values) {
            const p = entity.properties;
            const style = p?.style?.getValue?.();
            const name = entity.name ?? p?.name?.getValue?.();

            if (entity.polyline) {
                if (style === "arrow" || name === "B") {
                    const yellowTrans = Cesium.Color.YELLOW.withAlpha(0.5);
                    entity.polyline.width = 25;
                    entity.polyline.material = new Cesium.PolylineArrowMaterialProperty(yellowTrans);
                    entity.polyline.clampToGround = false;
                    entity.polyline.heightReference = Cesium.HeightReference.NONE;
                    guideBEntities.push(entity);
                } else {
                    entity.polyline.material = new Cesium.PolylineDashMaterialProperty({
                        color: Cesium.Color.RED,
                        gapColor: Cesium.Color.TRANSPARENT,
                        dashLength: 17,
                    });
                    entity.polyline.width = 4;
                    entity.polyline.clampToGround = true;
                }
            }
        }
        // スタート／ゴール（任意）
        viewer.entities.add({
            id: "home",                   // 任意の固定ID（なくてもOK）
            name: "スタート・ゴール地点",
            description: `
    <h3>スタート・ゴール地点</h3>
    <p>佐目集落登山口。トンネル入口脇に駐車場あり。</p>
    <ul>
      <li>標高: 約 220 m</li>
      <li>座標: 35.20 N, 136.33 E </li>
    </ul>
  `,
            position: Cesium.Cartesian3.fromDegrees(136.339949, 35.205891, 300),
            point: { pixelSize: 8, color: Cesium.Color.RED, outlineColor: Cesium.Color.WHITE, outlineWidth: 2 },
            label: {
                text: "Start/Finish",
                font: "14pt sans-serif",
                style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                fillColor: Cesium.Color.WHITE,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 3,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                pixelOffset: new Cesium.Cartesian2(0, -9),
            },
        });

        viewer.entities.add({
            id: "summit",                   // 任意の固定ID（なくてもOK）
            name: "高室山山頂",
            description: `
    <h3>高室山山頂</h3>
    <p>折り返し地点。眺望は360度のパノラマ。</p>
    <ul>
      <li>標高: 約 818 m</li>
      <li>座標: 35.22 N, 136.35 E </li>
    </ul>
  `,
            position: Cesium.Cartesian3.fromDegrees(136.3535710, 35.2200610, 855),
            point: { pixelSize: 8, color: Cesium.Color.RED, outlineColor: Cesium.Color.WHITE, outlineWidth: 2 },
            label: {
                text: "Mt.Takamuro(818m)",
                font: "14pt sans-serif",
                style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                fillColor: Cesium.Color.WHITE,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 3,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                pixelOffset: new Cesium.Cartesian2(0, -9),
            },
        });

        viewer.entities.add({
            id: "mt.ryozen",                   // 任意の固定ID（なくてもOK）
            name: "霊仙山",
            description: `
    <h3>霊仙山</h3>
    <p>高室山山頂から距離約7,000m、方位角17.6度。</p>
    <ul>
      <li>標高: 約 1,083 m</li>
      <li>座標: 35.28 N, 136.37 E</li>
    </ul>
  `,
            position: Cesium.Cartesian3.fromDegrees(136.3768988, 35.2803457, 1113),
            point: { pixelSize: 8, color: Cesium.Color.RED, outlineColor: Cesium.Color.WHITE, outlineWidth: 2 },
            label: {
                text: "Mt.Ryozen(1,083m)",
                font: "14pt sans-serif",
                style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                fillColor: Cesium.Color.WHITE,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 3,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                pixelOffset: new Cesium.Cartesian2(0, -9),
            },
        });

        viewer.flyTo(ds);
    } catch (e) {
        console.error("GeoJSON読み込みエラー:", e);
    }

    // === 概要ガイド（B）の表示トグル ===
    function setGuideBVisible(flag) { guideBEntities.forEach(ent => ent.show = flag); }
    setGuideBVisible(true);

    // id="btn-guideB" があれば紐づけ、なければ自動生成
    (function initGuideBToggle() {
        let btn = document.getElementById("btn-guideB");
        if (!btn) {
            const holder = document.createElement("div");
            holder.style.position = "absolute";
            holder.style.top = "10px";
            holder.style.right = "10px";
            holder.style.zIndex = "10";
            holder.style.background = "rgba(0,0,0,.45)";
            holder.style.backdropFilter = "blur(6px)";
            holder.style.borderRadius = "12px";
            holder.style.padding = "6px";

            btn = document.createElement("button");
            btn.id = "btn-guideB";
            btn.textContent = "Summary Route:ON";
            btn.style.border = "none";
            btn.style.padding = "6px 10px";
            btn.style.borderRadius = "8px";
            btn.style.cursor = "pointer";
            btn.style.color = "#fff";
            btn.style.background = "#2d8cff";

            holder.appendChild(btn);
            document.body.appendChild(holder);
        } else {
            btn.classList.add("active");
        }

        let visible = true;
        const refresh = () => {
            btn.textContent = visible ? "Summary Route:ON" : "Summary Route:OFF";
            if (!btn.classList.contains("active")) {
                btn.style.background = visible ? "#2d8cff" : "rgba(255,255,255,.12)";
            }
        };
        refresh();

        btn.onclick = () => { visible = !visible; setGuideBVisible(visible); refresh(); };
    })();
})();
